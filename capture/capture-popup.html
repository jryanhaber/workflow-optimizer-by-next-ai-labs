<!DOCTYPE html>
<html>
  <head>
    <title>Capture Work</title>
    <link rel="stylesheet" href="../styles/common.css" />
    <link rel="stylesheet" href="../styles/capture-popup.css" />
  </head>
  <body>
    <div class="capture-container">
      <h1>Capture Current Page</h1>

      <div class="capture-preview">
        <div id="screenshot-preview"></div>
        <div class="page-info">
          <div id="page-title"></div>
          <div id="page-url"></div>
        </div>
      </div>

      <div class="capture-form">
        <div class="input-group">
          <label for="capture-text">Description</label>
          <input type="text" id="capture-text" placeholder="What is this about?" />
        </div>

        <div class="input-group">
          <label>Tags</label>
          <div id="tag-container"></div>
        </div>

        <div class="capture-type">
          <button class="capture-btn todo" data-type="todo">
            <span class="icon">✓</span>
            <span class="label">Todo</span>
          </button>
          <button class="capture-btn inprogress" data-type="inprogress">
            <span class="icon">↻</span>
            <span class="label">In Progress</span>
          </button>

          <button class="capture-btn waiting" data-type="waiting">
            <span class="icon">⏱</span>
            <span class="label">Waiting For</span>
          </button>

          <button class="capture-btn completed" data-type="completed">
            <span class="icon">✓</span>
            <span class="label">Completed</span>
          </button>
        </div>
      </div>

      <div class="actions">
        <button id="view-all-btn">View All Items</button>
      </div>
    </div>

    <!-- Load scripts in correct order -->
    <script src="../utils/events.js"></script>
    <script src="../core/storage/data-store.js"></script>
    <script src="../components/tag-manager.js"></script>
    <script src="../capture/capture.js"></script>
    <script src="capture-popup.js"></script>

    <div style="margin-top: 16px; text-align: center">
      <button
        id="test-datastore-btn"
        style="background: #f1f1f1; border: 1px solid #ddd; padding: 8px 12px; cursor: pointer"
      >
        Test DataStore
      </button>
    </div>

    <script>
      // Add a test button to debug DataStore
      document.getElementById('test-datastore-btn').addEventListener('click', function () {
        console.clear();
        console.log('Testing DataStore...');

        // Check if DataStore exists
        console.log('DataStore exists:', !!window.DataStore);

        // Check if specific methods exist
        if (window.DataStore) {
          console.log('saveItem method exists:', typeof window.DataStore.saveItem === 'function');
          console.log(
            'getAllItems method exists:',
            typeof window.DataStore.getAllItems === 'function'
          );
          console.log('on method exists:', typeof window.DataStore.on === 'function');

          // Try to execute a method
          if (typeof window.DataStore.getAllItems === 'function') {
            console.log('Trying to call getAllItems...');
            window.DataStore.getAllItems()
              .then((items) => console.log('Items retrieved:', items))
              .catch((err) => console.error('Error getting items:', err));
          }
        }

        // List all scripts that have been loaded
        console.log('Loaded scripts:');
        document.querySelectorAll('script').forEach((script, i) => {
          console.log(`${i + 1}. ${script.src || 'inline script'}`);
        });

        alert('DataStore test complete - check console for results');
      });
    </script>
  </body>
</html>

<script>
  console.log('Starting script loading');

  // Define a console logger to track DataStore initialization
  (function () {
    const originalConsoleLog = console.log;
    console.log = function (...args) {
      if (args[0] === 'DataStore initialized') {
        console.trace('DataStore initialization stack trace');
      }
      originalConsoleLog.apply(console, args);
    };
  })();
</script>
